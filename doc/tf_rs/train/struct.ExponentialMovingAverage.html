<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `ExponentialMovingAverage` struct in crate `tf_rs`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, ExponentialMovingAverage">

    <title>tf_rs::train::ExponentialMovingAverage - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../main.css">
    

    
    
</head>
<body class="rustdoc struct">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Struct ExponentialMovingAverage</p><div class="block items"><ul><li><a href="#methods">Methods</a></li><li><a href="#implementations">Trait Implementations</a></li></ul></div><p class='location'><a href='../index.html'>tf_rs</a>::<wbr><a href='index.html'>train</a></p><script>window.sidebarCurrent = {name: 'ExponentialMovingAverage', ty: 'struct', relpath: ''};</script><script defer src="sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Struct <a href='../index.html'>tf_rs</a>::<wbr><a href='index.html'>train</a>::<wbr><a class="struct" href=''>ExponentialMovingAverage</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#41-47' title='goto source code'>[src]</a></span></h1>
<pre class='rust struct'>pub struct ExponentialMovingAverage { /* fields omitted */ }</pre><div class='docblock'><p>Maintains moving averages of variables by employing an exponential decay.</p>

<p>When training a model, it is often beneficial to maintain moving averages of
the trained parameters.  Evaluations that use averaged parameters sometimes
produce significantly better results than the final trained values.</p>

<p>The <code>apply()</code> method adds shadow copies of trained variables and add ops that
maintain a moving average of the trained variables in their shadow copies.
It is used when building the training model.  The ops that maintain moving
averages are typically run after each training step.
The <code>average()</code> and <code>average_name()</code> methods give access to the shadow
variables and their names.  They are useful when building an evaluation
model, or when restoring a model from a checkpoint file.  They help use the
moving averages in place of the last trained values for evaluations.</p>

<p>The moving averages are computed using exponential decay.  You specify the
decay value when creating the <code>ExponentialMovingAverage</code> object.  The shadow
variables are initialized with the same initial values as the trained
variables.  When you run the ops to maintain the moving averages, each
shadow variable is updated with the formula:</p>

<p><code>shadow_variable -= (1 - decay) * (shadow_variable - variable)</code></p>

<p>This is mathematically equivalent to the classic formula below, but the use
of an <code>assign_sub</code> op (the <code>&quot;-=&quot;</code> in the formula) allows concurrent lockless
updates to the variables:</p>

<p><code>shadow_variable = decay * shadow_variable + (1 - decay) * variable</code></p>

<p>Reasonable values for <code>decay</code> are close to 1.0, typically in the
multiple-nines range: 0.999, 0.9999, etc.</p>
</div>
                    <h2 id='methods' class='small-section-header'>
                      Methods<a href='#methods' class='anchor'></a>
                    </h2>
                <h3 id='impl' class='impl'><span class='in-band'><code>impl <a class="struct" href="../../tf_rs/train/struct.ExponentialMovingAverage.html" title="struct tf_rs::train::ExponentialMovingAverage">ExponentialMovingAverage</a></code><a href='#impl' class='anchor'></a></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#49-258' title='goto source code'>[src]</a></span></h3>
<div class='impl-items'><h4 id='method.new' class="method"><span id='new.v' class='invisible'><code>pub fn <a href='#method.new' class='fnname'>new</a>&lt;Tx&gt;(<br>&nbsp;&nbsp;&nbsp;&nbsp;decay: Tx, <br>&nbsp;&nbsp;&nbsp;&nbsp;num_updates: <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="../../tf_rs/ops/struct.Tensor.html" title="struct tf_rs::ops::Tensor">Tensor</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;zero_debias: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.bool.html">bool</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;name: &amp;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a><br>) -&gt; <a class="struct" href="../../tf_rs/train/struct.ExponentialMovingAverage.html" title="struct tf_rs::train::ExponentialMovingAverage">ExponentialMovingAverage</a> <span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;Tx: <a class="trait" href="https://doc.rust-lang.org/nightly/core/convert/trait.Into.html" title="trait core::convert::Into">Into</a>&lt;<a class="struct" href="../../tf_rs/ops/struct.Tensor.html" title="struct tf_rs::ops::Tensor">Tensor</a>&gt;,&nbsp;</span></code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#70-86' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Creates a new ExponentialMovingAverage object.</p>

<p>The <code>apply()</code> method has to be called to create shadow variables and add
ops to maintain moving averages.</p>

<p>The optional <code>num_updates</code> parameter allows one to tweak the decay rate
dynamically. It is typical to pass the count of training steps, usually
kept in a variable that is incremented at each step, in which case the
decay rate is lower at the start of training.  This makes moving averages
move faster.  If passed, the actual decay rate used is:</p>

<p><code>min(decay, (1 + num_updates) / (10 + num_updates))</code></p>

<h3 id='args' class='section-header'><a href='#args'>Args:</a></h3>
<ul>
<li>decay: The decay to use.</li>
<li>num_updates: Optional count of number of updates applied to variables.</li>
<li>zero_debias: If <code>true</code>, zero debias moving-averages that are initialized
with tensors.</li>
<li>name: Optional prefix name to use for the name of ops added in
<code>apply()</code>.</li>
</ul>
</div><h4 id='method.apply' class="method"><span id='apply.v' class='invisible'><code>pub fn <a href='#method.apply' class='fnname'>apply</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;mut self, <br>&nbsp;&nbsp;&nbsp;&nbsp;context: &amp;mut <a class="struct" href="../../tf_rs/ops/struct.Scope.html" title="struct tf_rs::ops::Scope">Scope</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;var_list: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">&amp;[</a><a class="struct" href="../../tf_rs/ops/struct.Tensor.html" title="struct tf_rs::ops::Tensor">Tensor</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a><br>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="struct" href="../../tf_rs/ops/struct.Group.html" title="struct tf_rs::ops::Group">Group</a>, <a class="struct" href="../../tf_rs/prelude/struct.TFError.html" title="struct tf_rs::prelude::TFError">Error</a>&gt;</code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#115-170' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Maintains moving averages of variables.</p>

<p><code>var_list</code> must be a list of <code>Tensor</code> or <code>Tensor</code> objects.  This method
creates shadow variables for all elements of <code>var_list</code>.  Shadow variables
for <code>Tensor</code> objects are initialized to the variable&#39;s initial value.
<del>They will be added to the <code>GraphKeys.MOVING_AVERAGE_VARIABLES</code> collection.</del>
For <code>Tensor</code> objects, the shadow variables are initialized to 0 and zero
debiased (see docstring in <code>assign_moving_average</code> for more details).</p>

<p><del>shadow variables are created with <code>trainable=False</code> and added to the
<code>GraphKeys.ALL_VARIABLES</code> collection.  They will be returned by calls to
<code>tf.global_variables()</code>.</del></p>

<p>Note that <code>apply()</code> can be called multiple times with different lists of
variables.</p>

<h3 id='args-1' class='section-header'><a href='#args-1'>Args:</a></h3>
<ul>
<li>var_list: A list of Tensor or Tensor objects. The variables
and Tensors must be of types float16, float32, or float64.</li>
</ul>

<h3 id='returns' class='section-header'><a href='#returns'>Returns:</a></h3>
<ul>
<li>Operation that updates the moving averages.</li>
</ul>

<h3 id='errors' class='section-header'><a href='#errors'>Errors:</a></h3>
<ul>
<li>TypeError: If the arguments are not all float16, float32, or float64.</li>
<li>ValueError: If the moving average of one of the variables is already
being computed.</li>
</ul>
</div><h4 id='method.average' class="method"><span id='average.v' class='invisible'><code>pub fn <a href='#method.average' class='fnname'>average</a>(&amp;self, var: &amp;<a class="struct" href="../../tf_rs/ops/struct.Tensor.html" title="struct tf_rs::ops::Tensor">Tensor</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;&amp;<a class="struct" href="../../tf_rs/ops/struct.Variable.html" title="struct tf_rs::ops::Variable">Variable</a>&gt;</code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#180-182' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Returns the <code>Tensor</code> holding the average of <code>var</code>.</p>

<h3 id='args-2' class='section-header'><a href='#args-2'>Args:</a></h3>
<ul>
<li>var: A <code>Tensor</code> object.</li>
</ul>

<h3 id='returns-1' class='section-header'><a href='#returns-1'>Returns:</a></h3>
<ul>
<li>A <code>Tensor</code> object or <code>None</code> if the moving average of <code>var</code>
is not maintained.</li>
</ul>
</div><h4 id='method.average_name' class="method"><span id='average_name.v' class='invisible'><code>pub fn <a href='#method.average_name' class='fnname'>average_name</a>(&amp;self, context: &amp;<a class="struct" href="../../tf_rs/ops/struct.Scope.html" title="struct tf_rs::ops::Scope">Scope</a>, var: &amp;<a class="struct" href="../../tf_rs/ops/struct.Tensor.html" title="struct tf_rs::ops::Tensor">Tensor</a>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" title="struct alloc::string::String">String</a></code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#203-213' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Returns the name of the <code>Tensor</code> holding the average for <code>var</code>.</p>

<p>The typical scenario for <code>ExponentialMovingAverage</code> is to compute moving
averages of variables during training, and restore the variables from the
computed moving averages during evaluations.</p>

<p>To restore variables, you have to know the name of the shadow variables.
That name and the original variable can then be passed to a <code>Saver()</code> object
to restore the variable from the moving average value with:
  <code>saver = tf.train.Saver({ema.average_name(var): var})</code></p>

<p><code>average_name()</code> can be called whether or not <code>apply()</code> has been called.</p>

<h3 id='args-3' class='section-header'><a href='#args-3'>Args:</a></h3>
<ul>
<li>var: A <code>Tensor</code> object.</li>
</ul>

<h3 id='returns-2' class='section-header'><a href='#returns-2'>Returns:</a></h3>
<ul>
<li>A string: The name of the variable that will be used or was used by the
 <code>ExponentialMovingAverage</code> type to hold the moving average of <code>var</code>.</li>
</ul>
</div><h4 id='method.variables_to_restore' class="method"><span id='variables_to_restore.v' class='invisible'><code>pub fn <a href='#method.variables_to_restore' class='fnname'>variables_to_restore</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;scope: &amp;<a class="struct" href="../../tf_rs/ops/struct.Scope.html" title="struct tf_rs::ops::Scope">Scope</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;moving_avg_variables: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">&amp;[</a><a class="struct" href="../../tf_rs/ops/struct.Variable.html" title="struct tf_rs::ops::Variable">Variable</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a><br>) -&gt; <a class="struct" href="https://doc.rust-lang.org/nightly/std/collections/hash/map/struct.HashMap.html" title="struct std::collections::hash::map::HashMap">HashMap</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/alloc/string/struct.String.html" title="struct alloc::string::String">String</a>, <a class="struct" href="../../tf_rs/ops/struct.Tensor.html" title="struct tf_rs::ops::Tensor">Tensor</a>&gt;</code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#229-257' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Returns a map of names to <code>Variables</code> to restore.</p>

<p>If a variable has a moving average, use the moving average variable name as
the restore name; otherwise, use the variable name.</p>

<h3 id='args-4' class='section-header'><a href='#args-4'>Args:</a></h3>
<ul>
<li>moving_avg_variables: a list of variables that require to use of the
moving variable name to be restored. <del>If empty, it will default to
context.moving_average_variables() + context.trainable_variables()</del></li>
</ul>

<h3 id='returns-3' class='section-header'><a href='#returns-3'>Returns:</a></h3>
<p>A map from restore_names to variables. The restore_name can be the
  moving_average version of the variable name if it exist, or the original
  variable name.</p>
</div></div>
            <h2 id='implementations' class='small-section-header'>
              Trait Implementations<a href='#implementations' class='anchor'></a>
            </h2>
        <h3 id='impl-Debug' class='impl'><span class='in-band'><code>impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> for <a class="struct" href="../../tf_rs/train/struct.ExponentialMovingAverage.html" title="struct tf_rs::train::ExponentialMovingAverage">ExponentialMovingAverage</a></code><a href='#impl-Debug' class='anchor'></a></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#40' title='goto source code'>[src]</a></span></h3>
<div class='impl-items'><h4 id='method.fmt' class="method"><span id='fmt.v' class='invisible'><code>fn <a href='https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html#tymethod.fmt' class='fnname'>fmt</a>(&amp;self, __arg_0: &amp;mut <a class="struct" href="https://doc.rust-lang.org/nightly/core/fmt/struct.Formatter.html" title="struct core::fmt::Formatter">Formatter</a>) -&gt; <a class="type" href="https://doc.rust-lang.org/nightly/core/fmt/type.Result.html" title="type core::fmt::Result">Result</a></code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#40' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Formats the value using the given formatter.</p>
</div></div><h3 id='impl-Clone' class='impl'><span class='in-band'><code>impl <a class="trait" href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html" title="trait core::clone::Clone">Clone</a> for <a class="struct" href="../../tf_rs/train/struct.ExponentialMovingAverage.html" title="struct tf_rs::train::ExponentialMovingAverage">ExponentialMovingAverage</a></code><a href='#impl-Clone' class='anchor'></a></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#40' title='goto source code'>[src]</a></span></h3>
<div class='impl-items'><h4 id='method.clone' class="method"><span id='clone.v' class='invisible'><code>fn <a href='https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone' class='fnname'>clone</a>(&amp;self) -&gt; <a class="struct" href="../../tf_rs/train/struct.ExponentialMovingAverage.html" title="struct tf_rs::train::ExponentialMovingAverage">ExponentialMovingAverage</a></code></span><span class='out-of-band'><div class='ghost'></div><a class='srclink' href='../../src/tf_rs/train/moving_averages.rs.html#40' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Returns a copy of the value. <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone">Read more</a></p>
</div><h4 id='method.clone_from' class="method"><span id='clone_from.v' class='invisible'><code>fn <a href='https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#method.clone_from' class='fnname'>clone_from</a>(&amp;mut self, source: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;</a>Self)</code></span><span class='out-of-band'><div class='ghost'></div><div class='since' title='Stable since Rust version 1.0.0'>1.0.0</div><a class='srclink' href='https://doc.rust-lang.org/nightly/src/core/clone.rs.html#112-114' title='goto source code'>[src]</a></span></h4>
<div class='docblock'><p>Performs copy-assignment from <code>source</code>. <a href="https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#method.clone_from">Read more</a></p>
</div></div></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>↑</dt>
                    <dd>Move up in search results</dd>
                    <dt>↓</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "tf_rs";
    </script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>